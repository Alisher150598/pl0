> **注:**  
> 1. 排除了数组，先不考虑数组的实现，有时间再弄  
> 2. 排除了function、array、of、type关键字
> 3. 如果有看不懂的地方，可以根据这里列的摘要，然后对照老师发的 ***编译课程设计项目.pdf*** 查看或开发

## 1. 对PL/0语言进行扩展

### 1.1. 现有的

#### 词法
1. 支持的算术运算符：+,-,*,/
2. 关系运算符：=,<>,<,<=,>,>=
3. 其他运算符：, ; . ( )
4. 赋值运算符：:=
5. 保留字：
	- 变量声明有关：const, var, procedure,
	- 程序控制有关：begin, end, if, then, while, do, 
	- 调用过程：call, 
	- 其他：odd

#### 语法
##### 基础语法
1. 标识符只能以字母开头，由数字、字母组成，最长为 10 个字符
2. 数字是无符号数，最多有 14 位
3. 过程的最大嵌套层数为 3 层
4. 定义常量的语法: const ident = number {, ident = number}; , 如果是赋值符号 := 则报错，因为常量声明时只能使用等号 = 
5. 定义变量的语法: var ident {, ident', ident''...}; ,
6. 定义过程的语法: procedure ident;

##### 语句 (statement)
1. 变量赋值: ident := expression; 
2. 调用过程: call ident(过程名)
3. 条件判断语句语法: if condition(条件语句) then statement
4. 过程定义语句: begin statement;{statement; ...} end
5. 循环语句语法: while condition(条件语句) do statement
7. 条件语句语法: odd(expression) | expression relop(条件运算符) expression, relop -> = | <> | > | >= | < | <=

##### 表达式 (expression)
- 表达式语法: [-]term {addop term ...}, addop -> + | -

##### 项 (term)
- 项的语法: factor {mulop factor ...}, mulop -> * | /

##### 因子 (factor)
- 因子的语法: ident | number | (expression{(expression)}), ident -> constant|variable

##### 语句必须以分号 ; 结尾

> factor是最小单位，其次是term，再次是expression，然后是statement，最后是block



### 1.2. 需要增加的

#### 词法
1. 增加像C语言那样的形式为 /* ... */ 的注释
2. 增加关键字: else 条件语句的else子句, exit 退出循环exit语句
3. 增加关键字: integer 整型, real 实型, Boolean 布尔型（不存在把 0 看成假，把非 0 看成真。）
4. 增加关键字: read 输入语句, write 输出语句
5. 增加关键字: true,false
6. 增加关键字: and,or,not
7. 增加关键字: div 整数除, mod 取模, / 实数除
8. number 是无符号数，若是实数，则采用小数点前后都有非空数字串这一种形式。
9. 当整数后面紧跟两个点时，例如“10..”，看成整数10和两个点，不要把两个点分开，把“10.”看成实数缺少小数点后的非空数字串。
	
#### 语法
1. 整型数据可以赋给实型变量（反之不行），实现时先将整型数据转换为实型数据，然后再赋值。
2. 本语言有布尔类型，有布尔常量false和true。C语言虽有逻辑运算，但没有布尔类型。本语言不存在把 0 看成假，把非 0 看成真。
3. 布尔类型的表达式按短路方式计算。
4. 若 exit 语句没有处于任何 while 语句中，则是一个错误。
5. exit语句作为while语句的非正常出口语句。若处于多层while语句中，则它只作为包含该 exit 的最内层 while 语句的非正常出口。
6. 读语句接受从键盘输入的数据，数据之间用空格分隔。读语句具有忽略当前输入行剩余字符，下一个读语句接受的数据另起一行的功能。
7. 写语句输出的数据显示在屏幕上，数据之间用空格分隔。写语句具有结束当前输出行，下次输出另起一行的功能。
8. 增加了写语句后，原来sto指令的输出功能取消，以免输出数据过多，不宜发现所关心的数据。



## 2. 对中间语言进行扩展

### 2.1. 现有的
> lit, opr, lod, sto, cal, Int, jmp, jpc  

- lit 0, a : 取常量a放到数据栈栈顶
- opr 0, a : 执行运算，a表示执行何种运算(+ - * / 取反...)
- lod l, a : 取变量放到数据栈栈顶(相对地址为a,层次差为l)
- sto l, a : 将数据栈栈顶内容存入变量(相对地址为a,层次差为l)
- cal l, a : 调用过程(入口指令地址为a,层次差为l)
- Int 0, a : 数据栈栈顶指针增加a
- jmp 0, a : 无条件转移到指令地址a
- jpc 0, a : 条件转移到指令地址a  

### 2.2. 需要增加的
1. 分离解释器和编译器为两个独立的程序: 编译器和解释器的接口是二进制的中间代码文件
2. 原编译器中listcode方式的中间代码列表输出功能略去，以便编译过程中的屏幕输出简洁（只有源程序和报错信息）；增加把完整的中间代码列表输出到文件的功能，以便实验评测时使用，该功能对于你测试和调试程序来说也是有用的。
3. 适应于拓展后的PL/0语法，需要新增的p-code指令，如red, wrt等
4. 修改interpreter函数，增加对新增p-code指令的处理